<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Runtime Configuration for AWS' Lambda | Widen Engineering</title>
  <meta name="description" content="A while ago Amazon released its Lambda service. Lambdas are simple, stateless  functions that get executed as callbacks to arbitrary AWS events.">

  <link rel="apple-touch-icon" sizes="57x57" href="/assets/favicon/apple-icon-57x57-443078e666f8564fe94d070b2e527a4e.png">
<link rel="apple-touch-icon" sizes="60x60" href="/assets/favicon/apple-icon-60x60-8a893e3ab71590ed3057de7e6cd3ae98.png">
<link rel="apple-touch-icon" sizes="72x72" href="/assets/favicon/apple-icon-72x72-f8c2f3ae23146687e05cc43b079e20f7.png">
<link rel="apple-touch-icon" sizes="76x76" href="/assets/favicon/apple-icon-76x76-c8d92c837a6f23b049e992c8d1ac4300.png">
<link rel="apple-touch-icon" sizes="114x114" href="/assets/favicon/apple-icon-114x114-e2a336df00d1c5b863ba753bbc65685b.png">
<link rel="apple-touch-icon" sizes="120x120" href="/assets/favicon/apple-icon-120x120-9dd8c2247c71ee7257d91cefcd651488.png">
<link rel="apple-touch-icon" sizes="144x144" href="/assets/favicon/apple-icon-144x144-977c40f1283a726696a38f03ca13d462.png">
<link rel="apple-touch-icon" sizes="152x152" href="/assets/favicon/apple-icon-152x152-a2b19091ea27d58f71346b1230fb6695.png">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-icon-180x180-c5f20e7c26f328953ad1bc7456a6b132.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/assets/favicon/android-icon-192x192-c18592872a77026c84201ce58a5c2b56.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32-ba8c5bfb24d4e1d4c9249c63a689dbc0.png">
<link rel="icon" type="image/png" sizes="96x96" href="/assets/favicon/favicon-96x96-e3521be3d5d9e10952a430e073a28fd3.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16-c488d0fbd40d0408f7ccb9b2fe8c787d.png">

<link rel="manifest" href="/assets/favicon/manifest-1ec559e0a7d1bdd5863ea8923dc00726.json">

<meta name="msapplication-TileColor" content="#B72822">
<meta name="msapplication-TileImage" content="/assets/favicon/ms-icon-144x144-977c40f1283a726696a38f03ca13d462.png">
<meta name="theme-color" content="#B72822">

  <link rel="stylesheet" href="/assets/app-87142aaebc5b8564f9220127fd8b5a59.css">
  <link rel="canonical" href="http://engineering.widen.com/blog/2015/08/27/AWS-Lambda-Runtime-Configuration">
  <link rel="alternate" type="application/rss+xml" title="Widen Engineering" href="http://engineering.widen.com/feed.xml" />
</head>


  <body>

    <div class="full-width">
      <header class="site-header" role="banner">
    <div class="wrapper">
        <div class="logo">
            <a href="/">
                <img width="400" alt="Widen-Engineering-White-Logo" src="http://embed.widencdn.net/img/widen/c17yrvuaac/400px@2x/Widen Engineering White Logo.png?u=mcuc7i">
            </a>
        </div>
        <br class="clear"/>
  </div>

</header>

    </div>

    <div class="wrapper">

      <main class="content" role="main">

        <div class="post">
    <header>
        <h1><a title="Runtime Configuration for AWS' Lambda" href="/blog/2015/08/27/AWS-Lambda-Runtime-Configuration">Runtime Configuration for AWS' Lambda</a></h1>
        <time datetime="2015-08-27T00:00:00-05:00">Aug 27, 2015</time> • Mark Feltner
    </header>

    <article role="article">

      <p>A while ago Amazon released its <a href="http://aws.amazon.com/lambda/">Lambda</a> service. Lambdas are simple, stateless  functions that get executed as callbacks to arbitrary AWS events.</p>

<p>One thing I disliked about Lambda is that you cannot provide any sort of runtime configuration to it. Because of this you are forced to build configuration into your source code either via the zip you give Lambda or through some other sort of mechanism.</p>

<p>Rebuilding and re-uploading a zip every time a configuration point changed was cumbersome, and having configuration baked into my Lambda seemed wrong. I wanted something like Elasticbeanstalk or ECS where I can just pass in environment variables and write my code to adapt.</p>

<p>The beauty of the Elasticbeanstalk/ECS model is that you do not have to write<br />
or ship new code to deal with a changing configuration value. When your<br />
database goes down would you rather deploy code to just change a value to a new endpoint?<br />
I wanted this model with Lambda, and it seemed to fit perfectly, but alas it was not so.</p>

<p>Development was slow, and dynamically configured Lambdas were looking less likely as time wore on.</p>

<p>Until the day I realized Lambdas can have an optional <code class="highlighter-rouge">description</code> <a href="http://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/Lambda.html#createFunction-property">when created</a>. Also, Lambdas can use the <a href="https://github.com/aws/aws-sdk-js">node aws-sdk</a> to make requests to other AWS web services, including Lambda itself.</p>

<p>I thought, “what if we used the description as configuration?”.</p>

<p>So I filled the description of the Lambda with valid JSON. Then I wrote some code in the Lambda so it’d grab its own description when it fired up.</p>

<p>Here’s an example of a Lambda that is processing its own description as a sort of runtime configuration.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">// This function is called 'whatstheenv'</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Loading event'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">aws</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'aws-sdk'</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">lambda</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">aws</span><span class="p">.</span><span class="nx">Lambda</span><span class="p">({</span><span class="na">apiVersion</span><span class="p">:</span> <span class="s1">'2014-11-11'</span><span class="p">});</span>
    <span class="nx">lambda</span><span class="p">.</span><span class="nx">getFunctionConfiguration</span><span class="p">({</span> <span class="na">FunctionName</span><span class="p">:</span> <span class="s2">"whatstheenv"</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span><span class="nx">context</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">stack</span><span class="p">);</span> <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">runtimeConfiguration</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nx">runtimeConfiguration</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">Description</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">except</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"unable to parse description as JSON"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">runtimeConfiguration</span><span class="p">);</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="s2">"We are done here."</span><span class="p">);</span>
    <span class="p">});</span>

<span class="p">};</span>
</code></pre>
</div>

<p>Now, we can simply edit the description in the console, and voilà, our next lambda run will have different data!</p>

<p>Obviously, we can use other sources such as SimpleDB, DynamoDB, S3, or GitHub as the source of our configuration, but using the lambda’s description gives us a quick and easy way to get dynamic configuration.</p>

<p>The downside is that it is fairly easy for someone to blow away your changes by unknowingly editing them via the AWS Console.</p>

<p>As always, weigh the risks and benefits.</p>


    </article>

    
</div>


      </main>

    </div>

    <div class="full-width">
      <div class="wrapper">
    <footer class="site-footer" role="contentinfo">
        <nav>
          <ul class="inline">
          
            
          
            
          
            
          
          </ul>
          <br/>
        </nav >
        <nav>
          <ul class="site-social-links inline">
              <li><a target="_blank" title="RSS Feed" href="/feed.xml" class="ion-social-rss"></a></li>
              <li><a target="_blank" title="GitHub" href="https://github.com/Widen" class="ion-social-github"></a></li>
              <li><a target="_blank" title="Twitter" href="https://twitter.com/widendev" class="ion-social-twitter"></a></li>
          </ul>
        </nav>
        <p>© Copyright 2017, <a title="Widen Homepage" target="_blank" href="http://widen.com">Widen Enterprises, Inc.</a></p>

        <p><strong>Looking for work?</strong> <a title="Come engineer with us!" target="_blank" href="http://www.widen.com/careers/">Come engineer with us!</a></p>
        <p><strong>Something wrong with this page?</strong> Please <a title="Create new issue on bugtracker" target="_blank" href="https://github.com/widen/widen.github.io/issues/new">file a bug</a>.</p>
        <div class="git-info">
<nav>
  <ul class="inline">
    <li>
        <a target="_blank" title="View site source on GitHub" href="https://github.com/widen/widen.github.io/">source</a>
    </li>
    <li>
        <a target="_blank" title="View current page on GitHub" href="https://github.com/widen/widen.github.io/blob/develop/_posts/2015-08-27-AWS-Lambda-Runtime-Configuration.md">view</a>
    </li>
    <li>
        <a target="_blank" title="Edit current page on GitHub" href="https://github.com/widen/widen.github.io/edit/develop/_posts/2015-08-27-AWS-Lambda-Runtime-Configuration.md">edit</a>
    </li>
    <li>
        <a ="_blank" title="Last site commit" href="https://github.com/widen/widen.github.io/commit/ed284c3">ed284c3</a>
    </li>
    <li>
        <a target="_blank" title="Last page commit" href="https://github.com/widen/widen.github.io/commit/c64fd46">c64fd46</a>
    </li>
  </ul>
  </nav >
</div>

    </footer>
</div>

    </div>

    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1206716-19']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


  </body>

</html>
